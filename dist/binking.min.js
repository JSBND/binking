/* binking v1.0.0 | Get bank logo, colors, brand and etc. by card number | https://github.com/binkingio/binking.git | by BinKing (https://binking.io) */
!function(){var c=function(e,a,n){var r=c._assign({},c.defaultResult),o=c._getOptionsAndCallback(a,n),t=o.options,s=o.callback;if(c._checkOptions(t,"Form"),r.cardNumberSource=e,r.cardNumberNormalized=c._getCardNumberNormalized(r.cardNumberSource),"archive"===t.strategy){if(6<=r.cardNumberNormalized.length){var i=c._getBankByCardNumber(r.cardNumberNormalized);c._appendResultWithArchiveBank(r,t,i)}if(c._appendResultWithBrand(r,t),t.sync)return r;if(s)s(r);else if(c._promiseSupported)return Promise.resolve(r)}else if(6<=r.cardNumberNormalized.length){var l={apiUrl:t.apiFormUrl,apiKey:t.apiKey,cardNumber:r.cardNumberNormalized.substr(0,6),sandbox:t.sandbox};if(s)c._apiRequest(l,function(e,a){a?console.error(a):c._appendResultByApiResponse(r,t,e),c._appendResultWithBrand(r,t),s(r)});else if(c._promiseSupported)return new Promise(function(n){c._apiRequest(l,function(e,a){a?console.error(a):c._appendResultByApiResponse(r,t,e),c._appendResultWithBrand(r,t),n(r)})})}else if(c._appendResultWithBrand(r,t),s)s(r);else if(c._promiseSupported)return Promise.resolve(r)};c.getBrand=function(e,a){var n=c._assign({},c.defaultOptions,a||{}),r=c._brands[e];if(!r)return null;var o=n.brandsLogosPath+r.alias+"-original.svg",t=n.brandsLogosPath+r.alias+"-dark.svg",s=n.brandsLogosPath+r.alias+"-light.svg";return c._assign({},r,{logoOriginalSvg:o,logoDarkSvg:t,logoLightSvg:s})},c.getBrands=function(e,a){var n,r;r=e?c._isArray(e)?(n=e,a):(n=Object.keys(c._brands),e):(n=Object.keys(c._brands),{});for(var o=[],t=0;t<n.length;t++){var s=n[t],i=c.getBrand(s,r);i&&o.push(i)}return o},c.getBank=function(e,a,n){var r,o=c._getOptionsAndCallback(a,n),t=o.options,s=o.callback;if(c._checkOptions(t,"Bank"),"archive"===t.strategy){var i=c._banks[e];if(r=i?c._appendResultWithArchiveBank({},t,i):null,t.sync)return r;if(s)s(r);else if(c._promiseSupported)return Promise.resolve(r)}else{var l={apiUrl:t.apiBankUrl,apiKey:t.apiKey,bankAlias:e,sandbox:t.sandbox};if(s)c._apiRequest(l,function(e,a){a?(console.error(a),s(null)):(r=e?c._appendResultByApiResponse({},t,e):null,s(r))});else if(c._promiseSupported)return new Promise(function(n){c._apiRequest(l,function(e,a){a?(console.error(a),n(null)):(r=e?c._appendResultByApiResponse({},t,e):null,n(r))})})}},c.getBanks=function(t,e,a){var n=c._getOptionsAndCallback(e,a),s=n.options,o=n.callback;c._checkOptions(s,"Banks");var i,l=[];if("archive"===s.strategy){for(i=0;i<t.length;i++){var r=t[i],g=c._banks[r],d=g?c._appendResultWithArchiveBank({},s,g):null;l.push(d)}if(s.sync)return l;if(o)o(l);else if(c._promiseSupported)return Promise.resolve(l)}else{var u={apiUrl:s.apiBanksUrl,apiKey:s.apiKey,banksAliases:t.join(","),sandbox:s.sandbox};if(o)c._apiRequest(u,function(e,a){if(a){for(console.error(a),i=0;i<t.length;i++)l.push(null);o(l)}else{for(i=0;i<e.length;i++){var n=e[i],r=n?c._appendResultByApiResponse({},s,n):null;l.push(r)}o(l)}});else if(c._promiseSupported)return new Promise(function(o){c._apiRequest(u,function(e,a){if(a){for(console.error(a),i=0;i<t.length;i++)l.push(null);o(l)}else{for(i=0;i<e.length;i++){var n=e[i],r=n?c._appendResultByApiResponse({},s,n):null;l.push(r)}o(l)}})})}},c.setDefaultOptions=function(e){c._assign(c.defaultOptions,e)},c._checkOptions=function(e,a){if("archive"===e.strategy){if(!Object.keys(c._bins).length)throw new Error("BinKing: you should add banks by binking.addBanks(banks) to use archive strategy");if(!Object.keys(c._banks).length)throw new Error("BinKing: you should add bins by binking.addBins(bins) to use archive strategy")}else{if("api"!==e.strategy)throw new Error('BinKing: you should set option "strategy" to "api" or "archive"');if(e["api"+a+"Url"]===c["_defaultApi"+a+"Url"]&&!e.apiKey)throw new Error('BinKing: you should set option "apiKey" if you use api strategy with default api url')}},c.setDefaultResult=function(e){e.formBackgroundColor&&(c.defaultResult.formBackgroundColor=e.formBackgroundColor),e.formBackgroundColors&&(c.defaultResult.formBackgroundColors=e.formBackgroundColors,c.defaultResult.formBackgroundGradient=c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees)),e.formBackgroundLightness&&(c.defaultResult.formBackgroundLightness=e.formBackgroundLightness),e.formTextColor&&(c.defaultResult.formTextColor=e.formTextColor),e.formBorderColor&&(c.defaultResult.formBorderColor=e.formBorderColor)},c._getOptionsAndCallback=function(e,a){var n=!e||c._isFunction(e)?{}:e;return{options:c._assign({},c.defaultOptions,n),callback:a||(c._isFunction(e)?e:null)}},c._banks={},c.addBanks=function(e){c._assign(c._banks,e)},c._bins={},c.addBins=function(e){c._assign(c._bins,e)},c._appendResultWithBrand=function(e,a){var n=c._getBrandByCardNumber(e.cardNumberNormalized);if(n){e.brandAlias=n.alias,e.brandName=n.name,e.brandLogoOriginalSvg=a.brandsLogosPath+n.alias+"-original.svg",e.brandLogoDarkSvg=a.brandsLogosPath+n.alias+"-dark.svg",e.brandLogoLightSvg=a.brandsLogosPath+n.alias+"-light.svg";var r=c._getFormBrandLogoBasename(e.brandAlias,a.brandLogoPolicy,e.backgroundLightness,e.formLogoScheme);e.formBrandLogoSvg=a.brandsLogosPath+r+".svg",e.codeName=n.codeName,e.codeMaxLength=n.codeMaxLength,e.codeMinLength=n.codeMinLength,e.cardNumberLengths=n.lengths,e.cardNumberGaps=n.gaps}e.cardNumberBlocks=c._getBlocks(e.cardNumberGaps,e.cardNumberLengths),e.cardNumberMask=c._getMask(a.maskDigitSymbol,a.maskDelimiterSymbol,e.cardNumberBlocks),e.cardNumberNice=c._getNumberNice(e.cardNumberNormalized,e.cardNumberGaps)},c._appendResultWithArchiveBank=function(e,a,n){return n&&(c._assign(e,n),e.bankLogoBigOriginalSvg=a.banksLogosPath+n.bankAlias+"-big-original.svg",e.bankLogoBigDarkSvg=a.banksLogosPath+n.bankAlias+"-big-dark.svg",e.bankLogoBigLightSvg=a.banksLogosPath+n.bankAlias+"-big-light.svg",e.bankLogoSmallOriginalSvg=a.banksLogosPath+n.bankAlias+"-small-original.svg",e.bankLogoSmallDarkSvg=a.banksLogosPath+n.bankAlias+"-small-dark.svg",e.bankLogoSmallLightSvg=a.banksLogosPath+n.bankAlias+"-small-light.svg",e.formBankLogoBigSvg=a.banksLogosPath+n.bankAlias+"-big-"+n.formLogoScheme+".svg",e.formBankLogoSmallSvg=a.banksLogosPath+n.bankAlias+"-small-"+n.formLogoScheme+".svg"),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,a.gradientDegrees),e},c._appendResultByApiResponse=function(e,a,n){return n&&c._assign(e,n),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,a.gradientDegrees),e},c._assign=function(){for(var e=arguments[0],a=1;a<arguments.length;a++){var n=arguments[a];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(n[r]instanceof Array?e[r]=c._assign([],n[r]):e[r]=n[r])}return e},c._getCardNumberNormalized=function(e){return(e+"").replace(/\D/g,"")},c._getBankByCardNumber=function(e){if(e.length<6)return null;var a=e.substr(0,6),n=c._bins[a];return n&&c._banks[n]||null},c._getGradient=function(e,a){return"linear-gradient("+a+"deg, "+e.join(", ")+")"},c._brands={visa:{name:"Visa",alias:"visa",pattern:/^4/,gaps:[4,8,12],lengths:[16,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},mastercard:{name:"Mastercard",alias:"mastercard",pattern:/^(51|52|53|54|55|22|23|24|25|26|27)/,gaps:[4,8,12],lengths:[16],codeName:"CVC",codeMinLength:3,codeMaxLength:3},"american-express":{name:"American Express",alias:"american-express",pattern:/^(34|37)/,gaps:[4,10],lengths:[15],codeName:"CID",codeMinLength:3,codeMaxLength:4},"diners-club":{name:"Diners Club",alias:"diners-club",pattern:/^(30|36|38|39)/,gaps:[4,10],lengths:[14,16,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},discover:{name:"Discover",alias:"discover",pattern:/^(60|64|65)/,gaps:[4,8,12],lengths:[16,19],codeName:"CID",codeMinLength:3,codeMaxLength:3},jcb:{name:"JCB",alias:"jcb",pattern:/^(18|21|35)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},unionpay:{name:"UnionPay",alias:"unionpay",pattern:/^(62)/,gaps:[4,8,12],lengths:[14,15,16,17,18,19],codeName:"CVN",codeMinLength:3,codeMaxLength:3},maestro:{name:"Maestro",alias:"maestro",pattern:/^(49|50|56|59|63|67)/,gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],codeName:"CVC",codeMinLength:3,codeMaxLength:3},mir:{name:"Mir",alias:"mir",pattern:/^(22)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVP2",codeMinLength:3,codeMaxLength:3}},c._getBrandByCardNumber=function(e){if(!e)return null;var a=[];for(var n in c._brands)Object.prototype.hasOwnProperty.call(c._brands,n)&&c._brands[n].pattern.test(e)&&a.push(this._brands[n]);return 1===a.length?a[0]:null},c._isArray=function(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)},c._isFunction=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},c._promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),c._getFormBrandLogoBasename=function(e,a,n,r){switch(a){case"auto":return e+"-"+(r||"original");case"original":return e+"-original";case"mono":return e+("light"===n?"-dark":"-light");case"dark":return e+"-dark";case"light":return e+"-light";default:return e+"-original"}},c._getBlocks=function(e,a){for(var n=a[a.length-1],r=[],o=e.length-1;0<=o;o--){var t=n-e[o];n-=t,r.push(t)}return r.push(n),r.reverse()},c._getMask=function(e,a,n){for(var r="",o=0;o<n.length;o++)r+=(o?a:"")+Array(n[o]+1).join(e);return r},c._getNumberNice=function(e,a){for(var n=[0].concat(a).concat([e.length]),r=[],o=0;n[o]<e.length;o++){var t=n[o],s=Math.min(n[o+1],e.length);r.push(e.substring(t,s))}return r.join(" ")},c._buildUrl=function(e,a){var n=e,r=!0;for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&void 0!==a[o]&&(n+=(r?"?":"&")+o+"="+a[o],r=!1);return n},c._apiRequestsCount=0,c._savedApiResults={},c._request=function(e,n){var a=new c._XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(){if(4===this.readyState){var e,a;try{e=JSON.parse(this.responseText)}catch(e){return a=new Error(this.responseText),n(null,a),!1}200!==this.status?(a=new Error("BinKing Api Error: "+e.message),n(null,a)):n(e)}},a.send()},c._apiRequest=function(e,n){var a=e.apiUrl,r=e.apiKey,o=e.cardNumber,t=e.bankAlias,s=e.banksAliases,i=e.sandbox,l=c._buildUrl(a,{apiKey:r,cardNumber:o,bankAlias:t,banksAliases:s,sandbox:i?1:void 0}),g=c._savedApiResults[l];if(g)if("pending"===g)var d=setInterval(function(){var e=c._savedApiResults[l];"pending"!==e&&(clearInterval(d),n(e[0],e[1]))},100);else n(g[0],g[1]);else c._apiRequestsCount++,c._savedApiResults[l]="pending",c._request(l,function(e,a){c._savedApiResults[l]=[e,a],n(e,a)})},c._XMLHttpRequest="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:void 0,c._defaultApiFormUrl="https://api.binking.io/form",c._defaultApiBankUrl="https://api.binking.io/bank",c._defaultApiBanksUrl="https://api.binking.io/banks",c.defaultOptions={strategy:"api",apiFormUrl:c._defaultApiFormUrl,apiBankUrl:c._defaultApiBankUrl,apiBanksUrl:c._defaultApiBanksUrl,apiKey:void 0,sandbox:!1,sync:!1,banksLogosPath:"",brandsLogosPath:"https://static.binking.io/brands-logos/",maskDigitSymbol:"0",maskDelimiterSymbol:" ",gradientDegrees:135,brandLogoPolicy:"auto"},c.defaultResult={bankAlias:null,bankName:null,bankLocalName:null,bankCountry:null,bankSite:null,bankPhone:null,bankLogoBigOriginalSvg:null,bankLogoBigDarkSvg:null,bankLogoBigLightSvg:null,bankLogoSmallOriginalSvg:null,bankLogoSmallDarkSvg:null,bankLogoSmallLightSvg:null,bankColor:null,bankColors:null,brandAlias:null,brandName:null,brandLogoOriginalSvg:null,brandLogoDarkSvg:null,brandLogoLightSvg:null,formBackgroundColor:"#eeeeee",formBackgroundColors:["#eeeeee","#dddddd"],formBackgroundGradient:c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees),formBackgroundLightness:"light",formTextColor:"#000000",formBorderColor:"#333333",formBrandLogoSvg:null,formBankLogoBigSvg:null,formBankLogoSmallSvg:null,formLogoScheme:null,codeName:null,codeMinLength:3,codeMaxLength:4,cardNumberMask:"0000 0000 0000 0000000",cardNumberGaps:[4,8,12],cardNumberBlocks:[4,4,4,7],cardNumberLengths:[12,13,14,15,16,17,18,19],cardNumberNice:"",cardNumberNormalized:"",cardNumberSource:void 0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.binking=c):"undefined"!=typeof window&&(window.binking=c)}();