/* binking v1.0.5 | Get bank logo, colors, phone, brand, validation and etc. by card number | https://github.com/binkingio/binking.git | by BinKing (https://binking.io) */
!function(){var c=function(e,a,r){var n=c._assign({},c.defaultResult),o=c._getOptionsAndCallback(a,r),t=o.options,i=o.callback;if(c._checkOptions(t,"Form"),n.cardNumberSource=e,n.cardNumberNormalized=c._getCardNumberNormalized(n.cardNumberSource),n.cardNumberValidByLuhn=c._isValidByLuhn(n.cardNumberNormalized),"archive"===t.strategy){if(6<=n.cardNumberNormalized.length){var s=c._getBankByCardNumber(n.cardNumberNormalized);c._appendResultWithArchiveBank(n,t,s)}if(c._appendResultWithBrand(n,t),t.sync)return n;if(i)i(n);else if(c._promiseSupported)return Promise.resolve(n)}else if(6<=n.cardNumberNormalized.length){var l={apiUrl:t.apiFormUrl,apiKey:t.apiKey,cardNumber:n.cardNumberNormalized.substr(0,6),sandbox:t.sandbox};if(i)c._apiRequest(l,function(e,a){a?console.error(a):c._appendResultByApiResponse(n,t,e),c._appendResultWithBrand(n,t),i(n)});else if(c._promiseSupported)return new Promise(function(r){c._apiRequest(l,function(e,a){a?console.error(a):c._appendResultByApiResponse(n,t,e),c._appendResultWithBrand(n,t),r(n)})})}else if(c._appendResultWithBrand(n,t),i)i(n);else if(c._promiseSupported)return Promise.resolve(n)};c.getBrand=function(e,a){var r=c._assign({},c.defaultOptions,a||{}),n=c._brands[e];if(!n)return null;var o=r.brandsLogosPath+n.alias+"-original.svg",t=r.brandsLogosPath+n.alias+"-dark.svg",i=r.brandsLogosPath+n.alias+"-light.svg";return c._assign({},n,{logoOriginalSvg:o,logoDarkSvg:t,logoLightSvg:i})},c.getBrands=function(e,a){var r,n;n=e?c._isArray(e)?(r=e,a):(r=Object.keys(c._brands),e):(r=Object.keys(c._brands),{});for(var o=[],t=0;t<r.length;t++){var i=r[t],s=c.getBrand(i,n);s&&o.push(s)}return o},c.getBank=function(e,a,r){var n,o=c._getOptionsAndCallback(a,r),t=o.options,i=o.callback;if(c._checkOptions(t,"Bank"),"archive"===t.strategy){var s=c._banks[e];if(n=s?c._appendResultWithArchiveBank({},t,s):null,t.sync)return n;if(i)i(n);else if(c._promiseSupported)return Promise.resolve(n)}else{var l={apiUrl:t.apiBankUrl,apiKey:t.apiKey,bankAlias:e,sandbox:t.sandbox};if(i)c._apiRequest(l,function(e,a){a?(console.error(a),i(null)):(n=e?c._appendResultByApiResponse({},t,e):null,i(n))});else if(c._promiseSupported)return new Promise(function(r){c._apiRequest(l,function(e,a){a?(console.error(a),r(null)):(n=e?c._appendResultByApiResponse({},t,e):null,r(n))})})}},c.getBanks=function(t,e,a){var r=c._getOptionsAndCallback(e,a),i=r.options,o=r.callback;c._checkOptions(i,"Banks");var s,l=[];if("archive"===i.strategy){for(s=0;s<t.length;s++){var n=t[s],d=c._banks[n],u=d?c._appendResultWithArchiveBank({},i,d):null;l.push(u)}if(i.sync)return l;if(o)o(l);else if(c._promiseSupported)return Promise.resolve(l)}else{var g={apiUrl:i.apiBanksUrl,apiKey:i.apiKey,banksAliases:t.join(","),sandbox:i.sandbox};if(o)c._apiRequest(g,function(e,a){if(a){for(console.error(a),s=0;s<t.length;s++)l.push(null);o(l)}else{for(s=0;s<e.length;s++){var r=e[s],n=r?c._appendResultByApiResponse({},i,r):null;l.push(n)}o(l)}});else if(c._promiseSupported)return new Promise(function(o){c._apiRequest(g,function(e,a){if(a){for(console.error(a),s=0;s<t.length;s++)l.push(null);o(l)}else{for(s=0;s<e.length;s++){var r=e[s],n=r?c._appendResultByApiResponse({},i,r):null;l.push(n)}o(l)}})})}},c.getBrandLogo=function(e,a,r){var n=a||"original";return c._assign({},c.defaultOptions,r||{}).brandsLogosPath+e+"-"+n+".svg"},c.setDefaultOptions=function(e){c._assign(c.defaultOptions,e)},c.setValidationErrors=function(e){c._assign(c.validationErrors,e)},c.validationErrors={CARD_NUMBER_REQUIRED:"Укажите номер вашей банковской карты",CARD_NUMBER_INVALID:"Номер карты содержит недопустимые символы",CARD_NUMBER_INCOMPLETE:"Номер карты заполнен не до конца",CARD_NUMBER_OVERCOMPLETE:"В номере карты слишком много символов",CARD_NUMBER_LUHN:"В номере карты содержится опечатка",MONTH_REQUIRED:"Укажите месяц истечения карты",MONTH_INVALID:"Ошибка в месяце истечения карты",YEAR_REQUIRED:"Укажите год истечения карты",YEAR_INVALID:"Ошибка в годе истечения карты",YEAR_IN_PAST:"Year is in the past",MONTH_IN_PAST:"Month is in the past",CODE_REQUIRED:"Укажите код безопасности",CODE_INVALID:"Код безопасности указан неверно"},c._isValidByLuhn=function(e){for(var a=0,r=!1,n=e.length-1;0<=n;n--){var o=e.charAt(n),t=parseInt(o,10);r&&9<(t*=2)&&(t-=9),a+=t,r=!r}return a%10==0},c.validateCardNumber=function(e){var a=e+"";if(!a)return c._makeValidationError("cardNumber","CARD_NUMBER_REQUIRED");if(/[^\d\s]+/.test(a))return c._makeValidationError("cardNumber","CARD_NUMBER_INVALID");var r=c._getCardNumberNormalized(a),n=c._getBrandByCardNumber(r),o=n?n.lengths[0]:12,t=n?n.lengths[n.lengths.length-1]:19;return r.length<o?c._makeValidationError("cardNumber","CARD_NUMBER_INCOMPLETE"):r.length>t?c._makeValidationError("cardNumber","CARD_NUMBER_OVERCOMPLETE"):c._isValidByLuhn(r)?void 0:c._makeValidationError("cardNumber","CARD_NUMBER_LUHN")},c.validateMonth=function(e){var a=e+"";if(!a)return c._makeValidationError("month","MONTH_REQUIRED");var r=parseInt(a);return!/^\d\d$/.test(a)||12<r||r<1?c._makeValidationError("month","MONTH_INVALID"):void 0},c.validateYear=function(e){var a=e+"";return a?/^\d\d$/.test(a)?void 0:c._makeValidationError("year","YEAR_INVALID"):c._makeValidationError("year","YEAR_REQUIRED")},c.validateDate=function(e,a){var r=parseInt(e),n=parseInt(a);if(!isNaN(r)&&!isNaN(n)){var o=new Date,t=o.getFullYear()%2e3,i=o.getMonth()+1;return n<t?c._makeValidationError("year","YEAR_IN_PAST"):t===n&&r<i?c._makeValidationError("month","MONTH_IN_PAST"):void 0}},c.validateCode=function(e){var a=e+"";return a?/^\d\d\d\d?$/.test(a)?void 0:c._makeValidationError("code","CODE_INVALID"):c._makeValidationError("code","CODE_REQUIRED")},c.validate=function(e,a,r,n){var o=!1,t={},i=c.validateCardNumber(e);i&&(t[i.field]=i,o=!0);var s=c.validateMonth(a);s&&(t[s.field]=s,o=!0);var l=c.validateYear(r);if(l&&(t[l.field]=l,o=!0),!s&&!l){var d=c.validateDate(a,r);d&&(t[d.field]=d,o=!0)}var u=c.validateCode(n);return u&&(t[u.field]=u,o=!0),{hasErrors:o,errors:t}},c._makeValidationError=function(e,a){return{field:e,code:a,message:c.validationErrors[a]}},c._checkOptions=function(e,a){if("archive"===e.strategy){if(!Object.keys(c._bins).length)throw new Error("BinKing: you should add banks by binking.addBanks(banks) to use archive strategy");if(!Object.keys(c._banks).length)throw new Error("BinKing: you should add bins by binking.addBins(bins) to use archive strategy")}else{if("api"!==e.strategy)throw new Error('BinKing: you should set option "strategy" to "api" or "archive"');if(e["api"+a+"Url"]===c["_defaultApi"+a+"Url"]&&!e.apiKey)throw new Error('BinKing: you should set option "apiKey" if you use api strategy with default api url')}},c.setDefaultResult=function(e){e.formBackgroundColor&&(c.defaultResult.formBackgroundColor=e.formBackgroundColor),e.formBackgroundColors&&(c.defaultResult.formBackgroundColors=e.formBackgroundColors,c.defaultResult.formBackgroundGradient=c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees)),e.formBackgroundLightness&&(c.defaultResult.formBackgroundLightness=e.formBackgroundLightness),e.formTextColor&&(c.defaultResult.formTextColor=e.formTextColor),e.formBorderColor&&(c.defaultResult.formBorderColor=e.formBorderColor)},c._getOptionsAndCallback=function(e,a){var r=!e||c._isFunction(e)?{}:e;return{options:c._assign({},c.defaultOptions,r),callback:a||(c._isFunction(e)?e:null)}},c._banks={},c.addBanks=function(e){c._assign(c._banks,e)},c._bins={},c.addBins=function(e){c._assign(c._bins,e)},c._appendResultWithBrand=function(e,a){var r=c._getBrandByCardNumber(e.cardNumberNormalized);if(r){e.brandAlias=r.alias,e.brandName=r.name,e.brandLogoOriginalSvg=a.brandsLogosPath+r.alias+"-original.svg",e.brandLogoDarkSvg=a.brandsLogosPath+r.alias+"-dark.svg",e.brandLogoLightSvg=a.brandsLogosPath+r.alias+"-light.svg";var n=c._getFormBrandLogoBasename(e.brandAlias,a.brandLogoPolicy,e.backgroundLightness,e.formLogoScheme);e.formBrandLogoSvg=a.brandsLogosPath+n+".svg",e.codeName=r.codeName,e.codeMaxLength=r.codeMaxLength,e.codeMinLength=r.codeMinLength,e.cardNumberLengths=r.lengths,e.cardNumberMaxLength=r.lengths[r.lengths.length-1],e.cardNumberMinLength=r.lengths[0],e.cardNumberGaps=r.gaps}e.cardNumberBlocks=c._getBlocks(e.cardNumberGaps,e.cardNumberLengths),e.cardNumberMask=c._getMask(a.maskDigitSymbol,a.maskDelimiterSymbol,e.cardNumberBlocks),e.cardNumberNice=c._getNumberNice(e.cardNumberNormalized,e.cardNumberGaps)},c._appendResultWithArchiveBank=function(e,a,r){return r&&(c._assign(e,r),e.bankLogoBigOriginalSvg=a.banksLogosPath+r.bankAlias+"-big-original.svg",e.bankLogoBigDarkSvg=a.banksLogosPath+r.bankAlias+"-big-dark.svg",e.bankLogoBigLightSvg=a.banksLogosPath+r.bankAlias+"-big-light.svg",e.bankLogoSmallOriginalSvg=a.banksLogosPath+r.bankAlias+"-small-original.svg",e.bankLogoSmallDarkSvg=a.banksLogosPath+r.bankAlias+"-small-dark.svg",e.bankLogoSmallLightSvg=a.banksLogosPath+r.bankAlias+"-small-light.svg",e.formBankLogoBigSvg=a.banksLogosPath+r.bankAlias+"-big-"+r.formLogoScheme+".svg",e.formBankLogoSmallSvg=a.banksLogosPath+r.bankAlias+"-small-"+r.formLogoScheme+".svg"),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,a.gradientDegrees),e},c._appendResultByApiResponse=function(e,a,r){return r&&c._assign(e,r),e.formBackgroundGradient=c._getGradient(e.formBackgroundColors,a.gradientDegrees),e},c._assign=function(){for(var e=arguments[0],a=1;a<arguments.length;a++){var r=arguments[a];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(r[n]instanceof Array?e[n]=c._assign([],r[n]):e[n]=r[n])}return e},c._getCardNumberNormalized=function(e){return(e+"").replace(/\D/g,"")},c._getBankByCardNumber=function(e){if(e.length<6)return null;var a=e.substr(0,6),r=c._bins[a];return r&&c._banks[r]||null},c._getGradient=function(e,a){return"linear-gradient("+a+"deg, "+e.join(", ")+")"},c._brands={visa:{name:"Visa",alias:"visa",pattern:/^4/,gaps:[4,8,12],lengths:[16,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},mastercard:{name:"Mastercard",alias:"mastercard",pattern:/^(51|52|53|54|55|22|23|24|25|26|27)/,gaps:[4,8,12],lengths:[16],codeName:"CVC",codeMinLength:3,codeMaxLength:3},"american-express":{name:"American Express",alias:"american-express",pattern:/^(34|37)/,gaps:[4,10],lengths:[15],codeName:"CID",codeMinLength:3,codeMaxLength:4},"diners-club":{name:"Diners Club",alias:"diners-club",pattern:/^(30|36|38|39)/,gaps:[4,10],lengths:[14,16,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},discover:{name:"Discover",alias:"discover",pattern:/^(60|64|65)/,gaps:[4,8,12],lengths:[16,19],codeName:"CID",codeMinLength:3,codeMaxLength:3},jcb:{name:"JCB",alias:"jcb",pattern:/^(18|21|35)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVV",codeMinLength:3,codeMaxLength:3},unionpay:{name:"UnionPay",alias:"unionpay",pattern:/^(62)/,gaps:[4,8,12],lengths:[14,15,16,17,18,19],codeName:"CVN",codeMinLength:3,codeMaxLength:3},maestro:{name:"Maestro",alias:"maestro",pattern:/^(49|50|56|59|63|67)/,gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],codeName:"CVC",codeMinLength:3,codeMaxLength:3},mir:{name:"Mir",alias:"mir",pattern:/^(22)/,gaps:[4,8,12],lengths:[16,17,18,19],codeName:"CVP2",codeMinLength:3,codeMaxLength:3}},c._getBrandByCardNumber=function(e){if(!e)return null;var a=[];for(var r in c._brands)Object.prototype.hasOwnProperty.call(c._brands,r)&&c._brands[r].pattern.test(e)&&a.push(this._brands[r]);return 1===a.length?a[0]:null},c._isArray=function(e){return!!e&&"[object Array]"===Object.prototype.toString.call(e)},c._isFunction=function(e){return!!e&&"[object Function]"===Object.prototype.toString.call(e)},c._promiseSupported="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),c._getFormBrandLogoBasename=function(e,a,r,n){switch(a){case"auto":return e+"-"+(n||"original");case"original":return e+"-original";case"mono":return e+("light"===r?"-dark":"-light");case"dark":return e+"-dark";case"light":return e+"-light";default:return e+"-original"}},c._getBlocks=function(e,a){for(var r=a[a.length-1],n=[],o=e.length-1;0<=o;o--){var t=r-e[o];r-=t,n.push(t)}return n.push(r),n.reverse()},c._getMask=function(e,a,r){for(var n="",o=0;o<r.length;o++)n+=(o?a:"")+Array(r[o]+1).join(e);return n},c._getNumberNice=function(e,a){for(var r=[0].concat(a).concat([e.length]),n=[],o=0;r[o]<e.length;o++){var t=r[o],i=Math.min(r[o+1],e.length);n.push(e.substring(t,i))}return n.join(" ")},c._buildUrl=function(e,a){var r=e,n=!0;for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&void 0!==a[o]&&(r+=(n?"?":"&")+o+"="+a[o],n=!1);return r},c._apiRequestsCount=0,c._savedApiResults={},c._request=function(e,r){var a=new c._XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(){if(4===this.readyState){var e,a;try{e=JSON.parse(this.responseText)}catch(e){return a=new Error(this.responseText),r(null,a),!1}200!==this.status?(a=new Error("BinKing Api Error: "+e.message),r(null,a)):r(e)}},a.send()},c._apiRequest=function(e,r){var a=e.apiUrl,n=e.apiKey,o=e.cardNumber,t=e.bankAlias,i=e.banksAliases,s=e.sandbox,l=c._buildUrl(a,{apiKey:n,cardNumber:o,bankAlias:t,banksAliases:i,sandbox:s?1:void 0}),d=c._savedApiResults[l];if(d)if("pending"===d)var u=setInterval(function(){var e=c._savedApiResults[l];"pending"!==e&&(clearInterval(u),r(e[0],e[1]))},100);else r(d[0],d[1]);else c._apiRequestsCount++,c._savedApiResults[l]="pending",c._request(l,function(e,a){c._savedApiResults[l]=[e,a],r(e,a)})},c._XMLHttpRequest="undefined"!=typeof XMLHttpRequest?XMLHttpRequest:void 0,c._defaultApiFormUrl="https://api.binking.io/form",c._defaultApiBankUrl="https://api.binking.io/bank",c._defaultApiBanksUrl="https://api.binking.io/banks",c.defaultOptions={strategy:"api",apiFormUrl:c._defaultApiFormUrl,apiBankUrl:c._defaultApiBankUrl,apiBanksUrl:c._defaultApiBanksUrl,apiKey:void 0,sandbox:!1,sync:!1,banksLogosPath:"",brandsLogosPath:"https://static.binking.io/brands-logos/",maskDigitSymbol:"0",maskDelimiterSymbol:" ",gradientDegrees:135,brandLogoPolicy:"auto"},c.defaultResult={bankAlias:null,bankName:null,bankLocalName:null,bankCountry:null,bankSite:null,bankPhone:null,bankLogoBigOriginalSvg:null,bankLogoBigDarkSvg:null,bankLogoBigLightSvg:null,bankLogoSmallOriginalSvg:null,bankLogoSmallDarkSvg:null,bankLogoSmallLightSvg:null,bankColor:null,bankColors:null,brandAlias:null,brandName:null,brandLogoOriginalSvg:null,brandLogoDarkSvg:null,brandLogoLightSvg:null,formBackgroundColor:"#eeeeee",formBackgroundColors:["#eeeeee","#dddddd"],formBackgroundGradient:c._getGradient(["#eeeeee","#dddddd"],c.defaultOptions.gradientDegrees),formBackgroundLightness:"light",formTextColor:"#000000",formBorderColor:"#333333",formBrandLogoSvg:null,formBankLogoBigSvg:null,formBankLogoSmallSvg:null,formLogoScheme:null,codeName:null,codeMinLength:3,codeMaxLength:4,cardNumberMask:"0000 0000 0000 0000000",cardNumberGaps:[4,8,12],cardNumberBlocks:[4,4,4,7],cardNumberLengths:[12,13,14,15,16,17,18,19],cardNumberMaxLength:19,cardNumberMinLength:12,cardNumberValidByLuhn:!0,cardNumberNice:"",cardNumberNormalized:"",cardNumberSource:void 0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.binking=c):"undefined"!=typeof window&&(window.binking=c)}();